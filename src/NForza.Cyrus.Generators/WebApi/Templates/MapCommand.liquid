
app.Map{{ Verb }}("{{ Path }}", async ({% if HasBody %}[FromBody] {{ CommandType | as-contract }} command{% endif -%}) =>
    await CommandDispatch.Execute{%- if ValidatorMethod != nil %}WithValidation{%- endif %}Async<{{ CommandType | as-contract }}, {{ CommandType }}>(
        app,
        command,
        {%- if ValidatorMethod != nil %}
        ctx => {% if ValidatorMethodIsStatic -%}
              {{ ValidatorClass }}.{{ ValidatorMethodName }}(cmd);
            {%- else -%}
              app.Services.GetRequiredService<{{ ValidatorClass }}>().{{ ValidatorMethodName }}(({{ CommandType }})ctx.Command)
            {%- endif %},
        {%- endif %}
        async (dispatcher, messageBus, cmd) => new CommandResultAdapter(messageBus).{{ AdapterMethod }}({% if HasReturnType %}await dispatcher.Handle(cmd){% endif %})))
    .WithOpenApi()
    {%- if Attributes.size > 0 -%}
    .WithMetadata([
    {%- for attr in Attributes %}
        {{ attr }}{% unless forloop.last %},{% endunless %}
    {% endfor %}])
    {%- endif -%};
